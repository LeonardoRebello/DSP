#include <stdio.h>

void Equalizador(FILE *Data_in, FILE *Data_out, float LOWPASS[], float BANDPASS[],
                 float HIGHPASS[], int Qnt_Amostras, float Gb, float Gm, float Ga){

    int i, Num_Amostras;
    short Read, Samples[Qnt_Amostras], Insert;

    for(i = 0; i < Qnt_Amostras; i++){

        Samples[i] = 0;
    }

    do{

        Insert = 0;

        Num_Amostras = fread(&Read, sizeof(short), 1, Data_in);
        Samples[0] = Read;

        for(i = 0; i < Qnt_Amostras; i++){

            Insert += (Samples[i] * LOWPASS[i] * Gb) + (Samples[i] * BANDPASS[i] * Gm) + (Samples[i] * HIGHPASS[i] * Ga);
        }

        for(i = Qnt_Amostras-1; i > 0; i--){

           Samples[i] = Samples[i - 1];
        }

        fwrite(&Insert, sizeof(short), 1, Data_out);
    }while(Num_Amostras);
}

int main(){

    FILE *Data_in, *Data_out;

    if((Data_in = fopen("Sweep_100_3k4.pcm", "rb")) == NULL){

        printf("\nO arquivo de entrada nï¿½o abriu");
        return 0;
    }

    if((Data_out = fopen("Sweep_100_3k4_Equalizador.pcm", "wb")) == NULL){

        printf("\nO arquivo de saida nao abriu");
        return 0;
    }

    int Qnt_Amostras = 192;
    float Gb = 0.8, Gm = 0.2, Ga = 0.6;

    float LOWPASS[] = {-3.2533903658785257e-19, -8.655798222847965e-05, -0.000167197534852655, -0.00023432638940620995, -0.00028093606709965344, -0.00030113393307679777, -0.00029072471203723567, -0.00024780382924865325, -0.000173295936235071, -7.134868679052718e-05, 5.051923748773427e-05, 0.00018161062538588716, 0.00030865146145190485, 0.0004168253760701756, 0.0004912041959417052, 0.0005184703760340297, 0.0004887618514579635, 0.00039741786101282495, 0.00024637594329886216, 4.4973763449995217e-05, -0.00019005086047771795, -0.00043549279032277196, -0.0006635706232229981, -0.0008446763705192829, -0.0009507549154354029, -0.0009589683057790586, -0.0008552146669059671, -0.0006370325664789232, -0.00031543994819232884, 8.466334116557101e-05, 0.0005257623015321644, 0.000960710928598108, 0.001337269446654546, 0.001603814743830224, 0.0017156529137622653, 0.0016412230309588488, 0.00136741609081714, 0.0009032582840600199, 0.0002813293253057214, -0.00044350132465478164, -0.0011981524679958902, -0.001898025964978811, -0.002455783236458054, -0.0027913634083387264, -0.002842170950123031, -0.0025722362933073067, -0.0019791609226018974, -0.0010978094980165012, 2.196038496968005e-18, 0.0012101539576761992, 0.00240511482659713, 0.0034463671637169862, 0.004199323740463065, 0.004549192304532459, 0.0044160600830942184, 0.0037673908828803927, 0.0026262701835436638, 0.0010740765807597753, -0.0007532203727106223, -0.0026752813301623097, -0.004483559593156252, -0.0059621119603614145, -0.006911138871622314, -0.0071708738269577015, -0.006643209509187101, -0.005308485592852935, -0.0032351854077911067, -0.0005808795281761691, 0.002416432382394309, 0.005456467950898364, 0.0082031660209438, 0.010317450668662848, 0.011493347382820146, 0.011493984407781592, 0.010183778050429755, 0.007553234404147315, 0.003733307889390621, -0.0010028931783975033, -0.006252141697641378, -0.011506661924547345, -0.01619168754770257, -0.01971220431281012, -0.021505032730085662, -0.02109169363748575, -0.018127199003391124, -0.012440067710704212, -0.004059482060679045, 0.0067734696004642025, 0.019612162895103754, 0.0338285590669715, 0.048653599029223484, 0.06323086836537191, 0.0766792539534011, 0.08815940637038652, 0.09693837993870674, 0.10244689310188458, 0.10432423536137034, 0.10244689310188458, 0.09693837993870674, 0.08815940637038652, 0.0766792539534011, 0.06323086836537191, 0.048653599029223484, 0.0338285590669715, 0.019612162895103754, 0.006773469600464203, -0.004059482060679046, -0.012440067710704212, -0.018127199003391124, -0.021091693637485753, -0.021505032730085662, -0.019712204312810122, -0.016191687547702574, -0.011506661924547345, -0.0062521416976413806, -0.0010028931783975033, 0.0037333078893906214, 0.007553234404147316, 0.010183778050429755, 0.011493984407781594, 0.011493347382820148, 0.010317450668662846, 0.0082031660209438, 0.005456467950898366, 0.0024164323823943094, -0.0005808795281761691, -0.0032351854077911067, -0.005308485592852934, -0.006643209509187103, -0.007170873826957703, -0.006911138871622316, -0.005962111960361415, -0.004483559593156252, -0.00267528133016231, -0.0007532203727106224, 0.0010740765807597755, 0.0026262701835436638, 0.0037673908828803923, 0.00441606008309422, 0.004549192304532459, 0.004199323740463065, 0.0034463671637169884, 0.0024051148265971287, 0.0012101539576762, 2.1960384969680052e-18, -0.0010978094980165012, -0.001979160922601899, -0.0025722362933073054, -0.0028421709501230325, -0.002791363408338727, -0.002455783236458054, -0.001898025964978813, -0.0011981524679958908, -0.00044350132465478185, 0.00028132932530572146, 0.00090325828406002, 0.0013674160908171407, 0.00164122303095885, 0.001715652913762266, 0.001603814743830224, 0.001337269446654546, 0.000960710928598109, 0.0005257623015321649, 8.466334116557104e-05, -0.0003154399481923292, -0.0006370325664789238, -0.0008552146669059667, -0.0009589683057790579, -0.0009507549154354031, -0.0008446763705192833, -0.000663570623222998, -0.00043549279032277256, -0.0001900508604777181, 4.497376344999524e-05, 0.0002463759432988626, 0.00039741786101282544, 0.0004887618514579638, 0.0005184703760340293, 0.0004912041959417054, 0.0004168253760701756, 0.0003086514614519047, 0.00018161062538588727, 5.0519237487734294e-05, -7.134868679052718e-05, -0.00017329593623507123, -0.0002478038292486534, -0.0002907247120372359, -0.0003011339330767976, -0.00028093606709965344, -0.00023432638940620995, -0.000167197534852655, -8.655798222847965e-05};
    float BANDPASS[] = {1.10596124924456e-18, -0.0001546915866794736, -5.046174650289283e-05, 0.00028924737709177503, 0.0005615668400958846, 0.0004998951281852617, 0.00017043345648763925, -8.072965240975532e-05, 1.8832123630961248e-07, 0.00027431175582867906, 0.0003327954659855983, -4.9766005951888665e-05, -0.0006169675103945965, -0.0008564368866638349, -0.0005558021799631398, -7.941006208369997e-05, -5.311390337608621e-07, -0.00043679647711360425, -0.000840533711528735, -0.0005614065593597701, 0.00037989519209051385, 0.0012034618698855467, 0.0011721929480820676, 0.00045057673037248136, 1.0331883423832493e-06, 0.0005115436146072455, 0.0015107308349101459, 0.0017604066489011285, 0.0006305371068056635, -0.0010568507374419348, -0.0017936854254989385, -0.0010559041007033492, -1.4532148932169375e-06, -0.00024564379039845093, -0.0019412774512258897, -0.0033721649967844904, -0.002733346206288494, -0.00024751611886756285, 0.0018532568693908256, 0.0017051137526269337, 1.3020360370870603e-06, -0.0006183398250221503, 0.0014396699284384958, 0.004633781900850308, 0.005681253304178822, 0.0031751122994928835, -0.0005973288831846685, -0.0019619437600995005, -7.465238432400779e-18, 0.00216271949761073, 0.0007258856704857983, -0.0042541203537784225, -0.008394084062673855, -0.007551852582597166, -0.0025888558930705838, 0.0012273424401421746, -2.853976028449612e-06, -0.004129463988982589, -0.004961839041749893, 0.0007330962399195757, 0.008962246888069455, 0.012250148139765573, 0.00782001880808758, 0.0010983067926637457, 7.21919656629464e-06, 0.005834483130318306, 0.01103712627898776, 0.007251107141133584, -0.00483023882015544, -0.015078667819716896, -0.014490836431234468, -0.005503650096435769, -1.2489856574081706e-05, -0.006131249901339886, -0.0179895739771697, -0.020872973793577054, -0.007462558781412918, 0.012519094812146407, 0.021329744275184522, 0.012646813052565348, 1.7595557536654455e-05, 0.0030191645282817633, 0.024333147335286055, 0.0433363837001962, 0.03623469912288872, 0.0034089001258453735, -0.026741837193640223, -0.026041717412551228, -2.131259880246497e-05, 0.011020684479654187, -0.028522518760125844, -0.104965929026377, -0.1532751803215317, -0.10882204570821001, 0.029256890415154224, 0.18308735989802943, 0.24999270865877288, 0.18308735989802943, 0.029256890415154224, -0.10882204570821001, -0.1532751803215317, -0.104965929026377, -0.028522518760125844, 0.011020684479654187, -2.131259880246497e-05, -0.026041717412551228, -0.026741837193640226, 0.0034089001258453735, 0.03623469912288873, 0.043336383700196206, 0.024333147335286055, 0.0030191645282817633, 1.7595557536657924e-05, 0.012646813052565348, 0.021329744275184526, 0.012519094812146407, -0.00746255878141292, -0.020872973793577054, -0.0179895739771697, -0.006131249901339886, -1.2489856574081706e-05, -0.005503650096435768, -0.014490836431234472, -0.015078667819716899, -0.004830238820155441, 0.007251107141133584, 0.011037126278987758, 0.005834483130318305, 7.219196566293773e-06, 0.0010983067926637466, 0.007820018808087581, 0.012250148139765576, 0.008962246888069455, 0.0007330962399195757, -0.004961839041749894, -0.00412946398898259, -2.853976028449612e-06, 0.0012273424401421733, -0.0025888558930705846, -0.007551852582597166, -0.008394084062673855, -0.004254120353778425, 0.0007258856704857983, 0.002162719497610731, -7.46523843240078e-18, -0.0019619437600995005, -0.0005973288831846689, 0.0031751122994928818, 0.005681253304178824, 0.004633781900850309, 0.0014396699284384958, -0.0006183398250221509, 1.3020360370872772e-06, 0.0017051137526269344, 0.001853256869390826, -0.00024751611886756274, -0.0027333462062884956, -0.003372164996784493, -0.0019412774512258904, -0.00024564379039845093, -1.4532148932169375e-06, -0.0010559041007033505, -0.00179368542549894, -0.0010568507374419352, 0.0006305371068056643, 0.0017604066489011303, 0.0015107308349101454, 0.0005115436146072451, 1.0331883423832493e-06, 0.0004505767303724815, 0.0011721929480820673, 0.001203461869885548, 0.00037989519209051417, -0.0005614065593597703, -0.0008405337115287365, -0.0004367964771136048, -5.311390337608079e-07, -7.941006208369986e-05, -0.0005558021799631401, -0.0008564368866638349, -0.0006169675103945962, -4.976600595188872e-05, 0.0003327954659855985, 0.00027431175582867906, 1.8832123630961248e-07, -8.072965240975538e-05, 0.00017043345648763938, 0.0004998951281852613, 0.0005615668400958846, 0.00028924737709177503, -5.046174650289283e-05, -0.0001546915866794736};
    float HIGHPASS[] = {-7.806222126567074e-19, 0.00024124956890795324, 0.00021765928135554784, -5.492098768556507e-05, -0.0002806307729962311, -0.00019876119510846383, 0.00012029125554959644, 0.00032853348165840857, 0.0001731076149987614, -0.00020296306903815186, -0.0003833147034733326, -0.0001318446194339985, 0.0003083160489426917, 0.0004396115105936594, 6.459798402143459e-05, -0.0004390603139503297, -0.0004882307124242026, 3.9378616100779295e-05, 0.0005941577682298728, 0.0005164327959097749, -0.00018984433161279592, -0.0007679690795627746, -0.0005086223248590695, 0.0003940996401468016, 0.0009497217270930196, 0.0004474246911718131, -0.0006555161680041789, -0.0011233740824222055, -0.0003150971586133347, 0.0009721873962763637, 0.0012679231239667741, 9.519317210524127e-05, -0.001335816231761329, -0.0013581709534317731, 0.00022562453746362442, 0.0017309419658256418, 0.0013659301154713538, -0.000655742165192457, -0.002134586194696547, -0.0012616124279721521, 0.001196850431958803, 0.0025163657900009614, 0.0010161133080195583, -0.001842418492511582, -0.0028390823540557905, -0.0006028760061855768, 0.002576489805786566, 0.003059753258116002, 5.269199935432774e-18, -0.003372873455286929, -0.0031310004970829283, 0.0008077531900614361, 0.004194760322210791, 0.0030026602780647074, -0.0018272041900236347, -0.004994733323022567, -0.002623416207515214, 0.0030553874082228137, 0.005715059414460515, 0.001942185090242734, -0.004478687294913202, -0.006288036179404159, -0.0009088799364652652, 0.006072567034293956, 0.0066359903126208064, -0.0005259975374653713, -0.007801940871196652, -0.006670227612957415, 0.002413806437761131, 0.00962219986881853, 0.006287670410290669, -0.004813800572227079, -0.011480857526246065, -0.005362734506441706, 0.007805795926739947, 0.013319739389429737, 0.0037292508920222975, -0.011516201633748904, -0.015077602577543144, -0.0011401511280180032, 0.016174091990165916, 0.016693039784528355, -0.0028281146052003916, -0.022244690062710445, -0.0181075001194976, 0.009031167584858838, 0.030801319254319268, 0.019268247812087025, -0.01959085029630129, -0.044849243546625686, -0.02013108026909764, 0.04173506066100508, 0.07659592636813059, 0.020662639337823488, -0.12619527035386097, -0.28553425299991403, 0.6456830559798568, -0.28553425299991403, -0.12619527035386097, 0.020662639337823488, 0.07659592636813059, 0.04173506066100508, -0.02013108026909764, -0.044849243546625686, -0.01959085029630129, 0.019268247812087025, 0.03080131925431927, 0.009031167584858838, -0.018107500119497605, -0.022244690062710452, -0.0028281146052003916, 0.01669303978452836, 0.016174091990165916, -0.0011401511280180032, -0.015077602577543146, -0.011516201633748904, 0.003729250892022298, 0.013319739389429737, 0.007805795926739947, -0.005362734506441708, -0.011480857526246066, -0.004813800572227078, 0.006287670410290671, 0.009622199868818534, 0.0024138064377611313, -0.006670227612957415, -0.0078019408711966515, -0.0005259975374653711, 0.006635990312620809, 0.006072567034293957, -0.0009088799364652653, -0.006288036179404161, -0.004478687294913202, 0.0019421850902427344, 0.005715059414460517, 0.0030553874082228146, -0.002623416207515214, -0.004994733323022566, -0.0018272041900236353, 0.0030026602780647074, 0.004194760322210791, 0.0008077531900614366, -0.003131000497082927, -0.0033728734552869307, 5.2691999354327746e-18, 0.003059753258116002, 0.002576489805786568, -0.0006028760061855766, -0.0028390823540557918, -0.0018424184925115823, 0.0010161133080195583, 0.002516365790000964, 0.0011968504319588035, -0.0012616124279721526, -0.0021345861946965475, -0.0006557421651924572, 0.001365930115471355, 0.001730941965825643, 0.00022562453746362448, -0.0013581709534317731, -0.001335816231761329, 9.519317210524138e-05, 0.0012679231239667752, 0.0009721873962763642, -0.00031509715861333505, -0.0011233740824222065, -0.0006555161680041786, 0.0004474246911718128, 0.0009497217270930198, 0.00039409964014680175, -0.0005086223248590694, -0.0007679690795627755, -0.00018984433161279605, 0.0005164327959097751, 0.0005941577682298739, 3.9378616100779336e-05, -0.000488230712424203, -0.0004390603139503294, 6.459798402143463e-05, 0.0004396115105936594, 0.00030831604894269153, -0.00013184461943399855, -0.0003833147034733328, -0.00020296306903815186, 0.00017310761499876161, 0.0003285334816584088, 0.0001202912555495965, -0.0001987611951084637, -0.0002806307729962311, -5.492098768556507e-05, 0.00021765928135554784, 0.00024124956890795324};

    Equalizador(Data_in, Data_out, LOWPASS, BANDPASS, HIGHPASS, Qnt_Amostras, Gb, Gm, Ga);

    fclose(Data_in);
    fclose(Data_out);

    return 0;
}
